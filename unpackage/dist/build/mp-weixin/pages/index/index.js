(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"1d88":function(e,t,n){"use strict";n.r(t);var o=n("22dc"),i=n.n(o);for(var r in o)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(r);t["default"]=i.a},"22dc":function(e,t,n){"use strict";(function(e,o){var i=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(n("7eb4")),a=i(n("ee10")),s=i(n("7ca3"));function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){(0,s.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var l={components:{uniPopup:function(){n.e("node-modules/@dcloudio/uni-ui/lib/uni-popup/uni-popup").then(function(){return resolve(n("bd26"))}.bind(null,n)).catch(n.oe)},uniPopupDialog:function(){Promise.all([n.e("common/vendor"),n.e("node-modules/@dcloudio/uni-ui/lib/uni-popup-dialog/uni-popup-dialog")]).then(function(){return resolve(n("2e2b"))}.bind(null,n)).catch(n.oe)},uniIcons:function(){Promise.all([n.e("common/vendor"),n.e("node-modules/@dcloudio/uni-ui/lib/uni-icons/uni-icons")]).then(function(){return resolve(n("9cfc"))}.bind(null,n)).catch(n.oe)}},data:function(){return{timers:[],activeCategory:0,categories:["所有","肉类","蔬菜","海鲜","主食","豆类"],items:[],editIndex:null,editTimeValue:"",newFoodName:"",newFoodTime:"",showCategoryPicker:!1,selectedCategory:"",ringtoneEnabled:!1}},computed:{filteredItems:function(){if(0===this.activeCategory)return this.items;var e=this.categories[this.activeCategory];return this.items.filter((function(t){return t.category===e}))}},onLoad:function(){},onShow:function(){var t=e.getStorageSync("token");t?(console.log("调用fetchCustomTimes方法"),e.showLoading({title:"正在加载食材信息..."}),this.fetchCustomTimes().finally((function(){e.hideLoading()}))):e.reLaunch({url:"/pages/login/index"})},methods:{getRingtoneUrl:function(e){var t=[{value:"default",url:"/static/ringtone/default.mp3"},{value:"light",url:"/static/ringtone/light.mp3"},{value:"QQ",url:"/static/ringtone/QQ.mp3"}].find((function(t){return t.value===e}));return t?t.url:"/static/ringtone/default.mp3"},playRingtone:function(t){var n=e.createInnerAudioContext();n.src=t,n.onError((function(t){console.error("音频播放失败:",t),e.showToast({title:"音频播放失败，请检查文件路径",icon:"none"})})),n.play()},startTimer:function(t){var n=this,o=u(u({},t),{},{time:t.time,ringtoneEnabled:!1,timer:setInterval((function(){if(o.time>0)o.time--;else if(clearInterval(o.timer),n.timers=n.timers.filter((function(e){return e!==o})),e.showToast({title:"".concat(o.name," 计时结束"),icon:"none"}),o.ringtoneEnabled){var t=e.getStorageSync("ringtone")||"default",i=n.getRingtoneUrl(t);n.playRingtone(i)}}),1e3)});this.timers.push(o)},stopTimer:function(e){clearInterval(this.timers[e].timer),this.timers.splice(e,1)},toggleRingtone:function(e){this.timers[e].ringtoneEnabled=!this.timers[e].ringtoneEnabled},changeCategory:function(e){this.activeCategory=e},addCategory:function(){this.$refs.categoryPopup.open()},confirmAddCategory:function(t){t?this.categories.includes(t)?e.showToast({title:"该分类已存在",icon:"none"}):(this.categories.push(t),this.activeCategory=this.categories.length-1,e.showToast({title:"添加成功",icon:"success"})):e.showToast({title:"分类名称不能为空",icon:"none"})},addFood:function(){this.newFoodName="",this.newFoodTime="",this.$refs.foodPopup.open()},confirmAddFoodName:function(t){t?(this.newFoodName=t,this.$refs.timePopup.open()):e.showToast({title:"食材名称不能为空",icon:"none"})},confirmAddFoodTime:function(t){if(isNaN(t)||t<=0)e.showToast({title:"请输入有效的时间",icon:"none"});else{if("所有"===this.categories[this.activeCategory])return this.newFoodTime=parseInt(t),void this.$refs.categoryPicker.open();var n=this.categories[this.activeCategory],o={name:this.newFoodName,time:parseInt(t),category:n};this.saveFood(o)}},confirmCategory:function(){if(this.selectedCategory){var t={name:this.newFoodName,time:this.newFoodTime,category:this.selectedCategory};this.saveFood(t),this.$refs.categoryPicker.close()}else e.showToast({title:"请选择分类",icon:"none"})},saveFood:function(t){this.items.push(t),e.showToast({title:"添加成功",icon:"success"}),this.saveCustomTime(t.name,t.time,t.category)},formatTime:function(e){var t=Math.floor(e/60),n=e%60;return"".concat(t,":").concat(n<10?"0":"").concat(n)},editTime:function(e){this.editIndex=e,this.editTimeValue=this.items[e].time,this.$refs.popup.open()},confirmEditTime:function(t){isNaN(t)||t<=0?e.showToast({title:"请输入有效的时间",icon:"none"}):(this.items[this.editIndex].time=parseInt(t),this.$refs.popup.close())},goToSettings:function(){e.navigateTo({url:"/pages/settings/index"})},saveCustomTime:function(t,n,i){var s=this;return(0,a.default)(r.default.mark((function a(){var c,u,l;return r.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(c=e.getStorageSync("phone"),u=e.getStorageSync("password"),console.log("phone:",c,"password:",u),!c||!u){r.next=16;break}return r.prev=4,console.log("调用get-custom-times云函数"),r.next=8,o.callFunction({name:"save-custom-times",data:{phone:c,password:u,items:[{name:t,time:n,category:i}]}});case 8:l=r.sent,200===l.result.code?(s.fetchCustomTimes(),e.showToast({title:"保存成功",icon:"success"})):e.showToast({title:l.result.message||"保存失败",icon:"none"}),r.next=16;break;case 12:r.prev=12,r.t0=r["catch"](4),e.showToast({title:"保存失败，请重试",icon:"none"}),console.error("保存失败:",r.t0);case 16:case"end":return r.stop()}}),a,null,[[4,12]])})))()},fetchCustomTimes:function(){var t=this;return(0,a.default)(r.default.mark((function n(){var i,a,s;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(i=e.getStorageSync("phone"),a=e.getStorageSync("password"),!i||!a){n.next=14;break}return n.prev=3,n.next=6,o.callFunction({name:"get-custom-times",data:{phone:i,password:a}});case 6:s=n.sent,200===s.result.code?t.items=s.result.data:e.showToast({title:"获取食材失败",icon:"none"}),n.next=14;break;case 10:n.prev=10,n.t0=n["catch"](3),e.showToast({title:"获取食材失败，请重试",icon:"none"}),console.error("获取食材失败:",n.t0);case 14:case"end":return n.stop()}}),n,null,[[3,10]])})))()},handleCategoryChange:function(e){var t=e.detail.value;this.selectedCategory=this.categories.filter((function(e){return"所有"!==e}))[t]}}};t.default=l}).call(this,n("df3c")["default"],n("861b")["uniCloud"])},6171:function(e,t,n){},"66ca":function(e,t,n){"use strict";var o=n("6171"),i=n.n(o);i.a},"9abf":function(e,t,n){"use strict";(function(e,t){var o=n("47a9");n("16e9"),n("861b");o(n("3240"));var i=o(n("cbac"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(i.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},ac0a:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return o}));var o={uniPopup:function(){return n.e("node-modules/@dcloudio/uni-ui/lib/uni-popup/uni-popup").then(n.bind(null,"bd26"))},uniPopupDialog:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/@dcloudio/uni-ui/lib/uni-popup-dialog/uni-popup-dialog")]).then(n.bind(null,"2e2b"))}},i=function(){var e=this,t=e.$createElement,n=(e._self._c,e.timers.length),o=n>0?e.__map(e.timers,(function(t,n){var o=e.__get_orig(t),i=e.formatTime(t.time);return{$orig:o,m0:i}})):null,i=e.categories.filter((function(e){return"所有"!==e}));e.$mp.data=Object.assign({},{$root:{g0:n,l0:o,g1:i}})},r=[]},cbac:function(e,t,n){"use strict";n.r(t);var o=n("ac0a"),i=n("1d88");for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);n("66ca");var a=n("828b"),s=Object(a["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);t["default"]=s.exports}},[["9abf","common/runtime","common/vendor"]]]);